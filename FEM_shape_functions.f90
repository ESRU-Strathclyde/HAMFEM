!****************************************************************************************
!****************************************************************************************
!
							MODULE FEM_shape_functions				  ! updated: mar 2005
!
!****************************************************************************************
!****************************************************************************************
! Documentation can be found in references at bottom.
!
	implicit none
!
CONTAINS
!
	subroutine nodesandgauss	(dim,lin,nogpel)
!	_____________________________________________________________________________________
		implicit none
		integer,intent(in)::dim
		logical,intent(in)::lin
		integer,intent(out)::nogpel(:)
!		---------------------------------------------------------------------------------
!	nogpel = NOdes and Gauss Points per ELement
!	nogpel(1):  number of nodes (nn) in trian. element
!	nogpel(2):  nn in quad. element
!	nogpel(3):  nn in trian. boundary element
!	nogpel(4):  nn in quad. boundary element
!	nogpel(5):  nuber of gauss points (ng) in trian. element (standard scheme)
!	nogpel(6):  ng in quad. element (standard scheme)
!	nogpel(7):  ng in trian. element (refined scheme)
!	nogpel(8):  ng in quad. element (refined scheme)
!	nogpel(9):  ng in trian. boundary element
!	nogpel(10): ng in quad. boundary element
		nodes: select case(dim)
			case(1)
				if (lin) then
					nogpel(1)=0; nogpel(2)=2; nogpel(3)=0; nogpel(4)=1
				else
					nogpel(1)=0; nogpel(2)=3; nogpel(3)=0; nogpel(4)=1
				endif
				nogpel(5)=0; nogpel(6)=3; nogpel(7)=0 
				nogpel(8)=10; nogpel(9)=0; nogpel(10)=1
			case(2)
				if (lin) then
					nogpel(1)=3; nogpel(2)=4; nogpel(3)=2; nogpel(4)=2
				else					
					nogpel(1)=6; nogpel(2)=8; nogpel(3)=3; nogpel(4)=3
				endif
				nogpel(5)=7; nogpel(6)=7; nogpel(7)=27
				nogpel(8)=24; nogpel(9)=0; nogpel(10)=3
			case(3)
				if (lin) then
					nogpel(1)=4; nogpel(2)=8; nogpel(3)=3; nogpel(4)=4
				else
					nogpel(1)=10; nogpel(2)=20; nogpel(3)=6; nogpel(4)=8 
				endif
				nogpel(5)=14; nogpel(6)=14; nogpel(7)=53 
				nogpel(8)=90; nogpel(9)=7; nogpel(10)=9
		end select nodes
!
	end subroutine nodesandgauss
!	_____________________________________________________________________________________
!
!
!
	subroutine gauss	(nogpel,lin,dim,wgp,Ni,dNi,Nimidq)
!	_____________________________________________________________________________________
		implicit none
		integer,intent(in)::nogpel(:),dim
		logical,intent(in)::lin
		double precision,intent(out)::wgp(:,:),Ni(:,:,:),dNi(:,:,:,:),Nimidq(:)
		integer::nne,ngp
!		---------------------------------------------------------------------------------
!	calculation of (derivatives of) shape function values at gauss points + weights
		wgp=0.0d0; Ni=0.0d0; dNi=0.0d0
		nne=nogpel(1); ngp=nogpel(5) ! triangular, standard scheme
		CALL GAUSSTRI (ngp,nne,lin,.FALSE.,dim,wgp(1:ngp,1),Ni(1:nne,1:ngp,1),dNi(1:nne,&
			&1:ngp,1:dim,1))			
		nne=nogpel(2); ngp=nogpel(6) ! quadrangular, standard scheme
		CALL GAUSSQUA (ngp,nne,lin,.FALSE.,dim,wgp(1:ngp,2),Ni(1:nne,1:ngp,2),dNi(1:nne,&
			&1:ngp,1:dim,2))
		nne=nogpel(1); ngp=nogpel(7) ! triangular, refined scheme
		CALL GAUSSTRI (ngp,nne,lin,.TRUE.,dim,wgp(1:ngp,3),Ni(1:nne,1:ngp,3),dNi(1:nne,&	
			&1:ngp,1:dim,3))			
		nne=nogpel(2); ngp=nogpel(8) ! quadrangular, refined scheme
		CALL GAUSSQUA (ngp,nne,lin,.TRUE.,dim,wgp(1:ngp,4),Ni(1:nne,1:ngp,4),dNi(1:nne,&
			&1:ngp,1:dim,4))			
		nne=nogpel(3); ngp=nogpel(9) ! triangular boundary
		CALL GAUSSTRI (ngp,nne,lin,.FALSE.,dim-1,wgp(1:ngp,5),Ni(1:nne,1:ngp,5),dNi(1:nne,&
			&1:ngp,1:dim-1,5))			
		nne=nogpel(4); ngp=nogpel(10) ! quadrangular boundary
		CALL GAUSSQUA (ngp,nne,lin,.FALSE.,dim-1,wgp(1:ngp,6),Ni(1:nne,1:ngp,6),dNi(1:nne,&
			&1:ngp,1:dim-1,6))		
!	determination of center values (for 2D graphical output)
		if (dim.EQ.2) Nimidq=0.25d0
!
	end subroutine gauss
!	_____________________________________________________________________________________
!
!
!
	subroutine gausstri	(ngp,nne,lin,refin,di,wg,N,dN)
!	_____________________________________________________________________________________
		implicit none
		integer,intent(in)::ngp,nne,di
		logical,intent(in)::lin,refin
		double precision,intent(out)::wg(:),N(:,:),dN(:,:,:)
		integer::igp,ine
		double precision::g,k,l,X,Y,Z,V,X0,Y0,Z0,V0
		double precision,allocatable::pos(:,:),nod0(:,:)
!		---------------------------------------------------------------------------------
!	calculation of shape function values for triangular elements
		wg=0.0d0; N=0.0d0; dN=0.0d0; allocate(pos(ngp,di+1),nod0(nne,di+1)); pos=0.0d0
!		
		shapefunc:select case (di)
			case(2)
				if (.NOT.refin) then ! degree 5
					pos(1,1)=0.33333333333333333d0
					pos(1,2)=0.33333333333333333d0
					pos(2,1)=0.10128650732345633d0
					pos(3,2)=0.10128650732345633d0
					pos(4,3)=0.10128650732345633d0
					pos(2,2)=0.10128650732345633d0
					pos(3,3)=0.10128650732345633d0
					pos(4,1)=0.10128650732345633d0
					pos(5,1)=0.47014206410511508d0
					pos(6,2)=0.47014206410511508d0
					pos(7,3)=0.47014206410511508d0
					pos(5,2)=0.47014206410511508d0
					pos(6,3)=0.47014206410511508d0
					pos(7,1)=0.47014206410511508d0
					wg(1)=0.1125d0
					wg(2:4)=0.062969590272413576d0 
					wg(5:7)=0.06619707639425309d0
				else ! degree 11
					pos(1,1)=0.032364948111275893d0
					pos(2,2)=0.032364948111275893d0
					pos(3,3)=0.032364948111275893d0
					pos(1,2)=0.032364948111275893d0
					pos(2,3)=0.032364948111275893d0
					pos(3,1)=0.032364948111275893d0
					pos(4,1)=0.11935091228258130d0
					pos(5,2)=0.11935091228258130d0
					pos(6,3)=0.11935091228258130d0
					pos(4,2)=0.11935091228258130d0
					pos(5,3)=0.11935091228258130d0
					pos(6,1)=0.11935091228258130d0
					pos(7,1)=0.53461104827075830d0
					pos(8,2)=0.53461104827075830d0
					pos(9,3)=0.53461104827075830d0
					pos(7,2)=0.53461104827075830d0
					pos(8,3)=0.53461104827075830d0
					pos(9,1)=0.53461104827075830d0
					pos(10,1)=0.20330990043128247d0
					pos(11,2)=0.20330990043128247d0
					pos(12,3)=0.20330990043128247d0
					pos(10,2)=0.20330990043128247d0
					pos(11,3)=0.20330990043128247d0
					pos(12,1)=0.20330990043128247d0
					pos(13,1)=0.39896930296585522d0
					pos(14,2)=0.39896930296585522d0
					pos(15,3)=0.39896930296585522d0
					pos(13,2)=0.39896930296585522d0
					pos(14,3)=0.39896930296585522d0
					pos(15,1)=0.39896930296585522d0
					pos(16,1)=0.59320121342821275d0
					pos(17,1)=0.59320121342821275d0
					pos(18,1)=0.050178138310494665d0
					pos(19,1)=0.050178138310494665d0
					pos(20,2)=0.59320121342821275d0
					pos(21,2)=0.050178138310494665d0
					pos(16,2)=0.050178138310494665d0
					pos(17,3)=0.050178138310494665d0
					pos(18,2)=0.59320121342821275d0
					pos(19,3)=0.59320121342821275d0
					pos(20,3)=0.050178138310494665d0
					pos(21,3)=0.59320121342821275d0
					pos(22,1)=0.80748900315979215d0
					pos(23,1)=0.80748900315979215d0
					pos(24,1)=0.021022016536166297d0
					pos(25,1)=0.021022016536166297d0
					pos(26,2)=0.80748900315979215d0
					pos(27,2)=0.021022016536166297d0
					pos(22,2)=0.021022016536166297d0
					pos(23,3)=0.021022016536166297d0
					pos(24,2)=0.80748900315979215d0
					pos(25,3)=0.80748900315979215d0
					pos(26,3)=0.021022016536166297d0
					pos(27,3)=0.80748900315979215d0
					wg(1:3)=6.8298655013389309d-3
					wg(4:6)=0.018092270251709039d0
					wg(7:9)=4.6350316448033802d-4
					wg(10:12)=0.029661488690387036d0
					wg(13:15)=0.038574767457406561d0
					wg(16:21)=0.026168555981102035d0
					wg(22:27)=0.010353829819570344d0
				endif
				if (lin) then
					nod0(1,1)=+1.0d0; nod0(1,2)= 0.0d0; nod0(1,3)= 0.0d0
					nod0(2,1)= 0.0d0; nod0(2,2)=+1.0d0; nod0(2,3)= 0.0d0
					nod0(3,1)= 0.0d0; nod0(3,2)= 0.0d0; nod0(3,3)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3)
						if (X.EQ.0.0d0) X=1.0d0-Y-Z
						if (Y.EQ.0.0d0) Y=1.0d0-Z-X
						if (Z.EQ.0.0d0) Z=1.0d0-X-Y
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3)
							N(ine,igp)=X0*X+Y0*Y+Z0*Z
							dN(ine,igp,1)=X0-Z0
							dN(ine,igp,2)=Y0-Z0
						enddo
					enddo
				else
					nod0(1,1)=+1.0d0; nod0(1,2)= 0.0d0; nod0(1,3)= 0.0d0
					nod0(2,1)= 0.0d0; nod0(2,2)=+1.0d0; nod0(2,3)= 0.0d0
					nod0(3,1)= 0.0d0; nod0(3,2)= 0.0d0; nod0(3,3)=+1.0d0
					nod0(4,1)=+0.5d0; nod0(4,2)=+0.5d0; nod0(4,3)= 0.0d0
					nod0(5,1)= 0.0d0; nod0(5,2)=+0.5d0; nod0(5,3)=+0.5d0
					nod0(6,1)=+0.5d0; nod0(6,2)= 0.0d0; nod0(6,3)=+0.5d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3)
						if (X.EQ.0.0d0) X=1.0d0-Y-Z
						if (Y.EQ.0.0d0) Y=1.0d0-Z-X
						if (Z.EQ.0.0d0) Z=1.0d0-X-Y
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3)
							if (ine.LE.3) then
								N(ine,igp)=X0*(2.0d0*X*X-X)+Y0*(2.0d0*Y*Y-Y)+Z0*&
									&(2.0d0*Z*Z-Z)
								dN(ine,igp,1)=X0*(4.0d0*X-1.0d0)-Z0*(4.0d0*Z-1.0d0)
								dN(ine,igp,2)=Y0*(4.0d0*Y-1.0d0)-Z0*(4.0d0*Z-1.0d0)
							else
								N(ine,igp)=1.6d1*(X0*Y0*X*Y+Y0*Z0*Y*Z+Z0*X0*Z*X)
								dN(ine,igp,1)=1.6d1*(X0*Y0*Y-Y0*Z0*Y+Z0*X0*Z-Z0*X0*X)
								dN(ine,igp,2)=1.6d1*(X0*Y0*X+Y0*Z0*Z-Y0*Z0*Y-Z0*X0*X)
							endif
						enddo
					enddo
				endif
			case(3)
				if (.NOT.refin) then ! degree 5
					pos(1,1)=0.092735250310891226d0
					pos(2,2)=0.092735250310891226d0
					pos(3,3)=0.092735250310891226d0
					pos(4,4)=0.092735250310891226d0
					pos(1,2)=0.092735250310891226d0
					pos(2,3)=0.092735250310891226d0
					pos(3,4)=0.092735250310891226d0
					pos(4,1)=0.092735250310891226d0
					pos(1,3)=0.092735250310891226d0
					pos(2,4)=0.092735250310891226d0
					pos(3,1)=0.092735250310891226d0
					pos(4,2)=0.092735250310891226d0
					pos(5,1)=0.31088591926330060d0
					pos(6,2)=0.31088591926330060d0
					pos(7,3)=0.31088591926330060d0
					pos(8,4)=0.31088591926330060d0
					pos(5,2)=0.31088591926330060d0
					pos(6,3)=0.31088591926330060d0
					pos(7,4)=0.31088591926330060d0
					pos(8,1)=0.31088591926330060d0
					pos(5,3)=0.31088591926330060d0
					pos(6,4)=0.31088591926330060d0
					pos(7,1)=0.31088591926330060d0
					pos(8,2)=0.31088591926330060d0
					pos(9,1)=0.45449629587435035d0
					pos(10,1)=0.45449629587435035d0
					pos(11,1)=0.45449629587435035d0
					pos(12,1)=0.045503704125649649d0
					pos(13,1)=0.045503704125649649d0
					pos(14,1)=0.045503704125649649d0
					pos(9,2)=0.45449629587435035d0
					pos(10,2)=0.045503704125649649d0
					pos(11,2)=0.045503704125649649d0
					pos(12,2)=0.45449629587435035d0
					pos(13,2)=0.45449629587435035d0
					pos(14,2)=0.45449629587435035d0
					pos(9,3)=0.045503704125649649d0
					pos(10,3)=0.45449629587435035d0
					pos(11,3)=0.045503704125649649d0
					pos(12,3)=0.45449629587435035d0
					pos(13,3)=0.045503704125649649d0
					pos(14,3)=0.45449629587435035d0					
					wg(1:4)=0.012248840519393658d0
					wg(5:8)=0.018781320953002641d0
					wg(9:14)=7.0910034628469110d-3
				else  ! degree 9
					pos(1,1)=0.25d0
					pos(1,2)=0.25d0
					pos(1,3)=0.25d0
					pos(2,1)=0.048351038549736740d0
					pos(3,2)=0.048351038549736740d0
					pos(4,3)=0.048351038549736740d0
					pos(5,4)=0.048351038549736740d0
					pos(2,2)=0.048351038549736740d0
					pos(3,3)=0.048351038549736740d0
					pos(4,4)=0.048351038549736740d0
					pos(5,1)=0.048351038549736740d0
					pos(2,3)=0.048351038549736740d0
					pos(3,4)=0.048351038549736740d0
					pos(4,1)=0.048351038549736740d0
					pos(5,2)=0.048351038549736740d0
					pos(6,1)=0.32457928011788236d0
					pos(7,2)=0.32457928011788236d0
					pos(8,3)=0.32457928011788236d0
					pos(9,4)=0.32457928011788236d0
					pos(6,2)=0.32457928011788236d0
					pos(7,3)=0.32457928011788236d0
					pos(8,4)=0.32457928011788236d0
					pos(9,1)=0.32457928011788236d0
					pos(6,3)=0.32457928011788236d0
					pos(7,4)=0.32457928011788236d0
					pos(8,1)=0.32457928011788236d0
					pos(9,2)=0.32457928011788236d0
					pos(10,1)=0.11461654022399521d0
					pos(11,2)=0.11461654022399521d0
					pos(12,3)=0.11461654022399521d0
					pos(13,4)=0.11461654022399521d0
					pos(10,2)=0.11461654022399521d0
					pos(11,3)=0.11461654022399521d0
					pos(12,4)=0.11461654022399521d0
					pos(13,1)=0.11461654022399521d0
					pos(10,3)=0.11461654022399521d0
					pos(11,4)=0.11461654022399521d0
					pos(12,1)=0.11461654022399521d0
					pos(13,2)=0.11461654022399521d0
					pos(14,1)=0.22548995191151391d0
					pos(15,2)=0.22548995191151391d0
					pos(16,3)=0.22548995191151391d0
					pos(17,4)=0.22548995191151391d0
					pos(14,2)=0.22548995191151391d0
					pos(15,3)=0.22548995191151391d0
					pos(16,4)=0.22548995191151391d0
					pos(17,1)=0.22548995191151391d0
					pos(14,3)=0.22548995191151391d0
					pos(15,4)=0.22548995191151391d0
					pos(16,1)=0.22548995191151391d0
					pos(17,2)=0.22548995191151391d0
					pos(18,1)=0.13162780924686980d0
					pos(19,1)=0.13162780924686980d0
					pos(20,1)=0.083664701617184967d0
					pos(21,1)=0.13162780924686980d0
					pos(22,1)=0.083664701617184967d0
					pos(23,1)=0.13162780924686980d0
					pos(24,1)=0.083664701617184967d0
					pos(25,1)=0.13162780924686980d0
					pos(26,1)=0.13162780924686980d0
					pos(27,2)=0.13162780924686980d0
					pos(28,2)=0.13162780924686980d0
					pos(29,2)=0.083664701617184967d0
					pos(18,2)=0.13162780924686980d0
					pos(19,2)=0.083664701617184967d0
					pos(20,2)=0.13162780924686980d0
					pos(21,2)=0.083664701617184967d0
					pos(22,2)=0.13162780924686980d0
					pos(23,2)=0.13162780924686980d0
					pos(24,3)=0.13162780924686980d0
					pos(25,3)=0.13162780924686980d0
					pos(26,3)=0.083664701617184967d0
					pos(27,3)=0.13162780924686980d0
					pos(28,3)=0.083664701617184967d0
					pos(29,3)=0.13162780924686980d0
					pos(18,3)=0.083664701617184967d0
					pos(19,3)=0.13162780924686980d0
					pos(20,3)=0.13162780924686980d0
					pos(21,4)=0.13162780924686980d0
					pos(22,4)=0.13162780924686980d0
					pos(23,4)=0.083664701617184967d0
					pos(24,4)=0.13162780924686980d0
					pos(25,4)=0.083664701617184967d0
					pos(26,4)=0.13162780924686980d0
					pos(27,4)=0.083664701617184967d0
					pos(28,4)=0.13162780924686980d0
					pos(29,4)=0.13162780924686980d0
					pos(30,1)=0.43395146141140677d0
					pos(31,1)=0.43395146141140677d0
					pos(32,1)=0.10776985954942861d0
					pos(33,1)=0.43395146141140677d0
					pos(34,1)=0.10776985954942861d0
					pos(35,1)=0.43395146141140677d0
					pos(36,1)=0.10776985954942861d0
					pos(37,1)=0.43395146141140677d0
					pos(38,1)=0.43395146141140677d0
					pos(39,2)=0.43395146141140677d0
					pos(40,2)=0.43395146141140677d0
					pos(41,2)=0.10776985954942861d0
					pos(30,2)=0.43395146141140677d0
					pos(31,2)=0.10776985954942861d0
					pos(32,2)=0.43395146141140677d0
					pos(33,2)=0.10776985954942861d0
					pos(34,2)=0.43395146141140677d0
					pos(35,2)=0.43395146141140677d0
					pos(36,3)=0.43395146141140677d0
					pos(37,3)=0.43395146141140677d0
					pos(38,3)=0.10776985954942861d0
					pos(39,3)=0.43395146141140677d0
					pos(40,3)=0.10776985954942861d0
					pos(41,3)=0.43395146141140677d0
					pos(30,3)=0.10776985954942861d0
					pos(31,3)=0.43395146141140677d0
					pos(32,3)=0.43395146141140677d0
					pos(33,4)=0.43395146141140677d0
					pos(34,4)=0.43395146141140677d0
					pos(35,4)=0.10776985954942861d0
					pos(36,4)=0.43395146141140677d0
					pos(37,4)=0.10776985954942861d0
					pos(38,4)=0.43395146141140677d0
					pos(39,4)=0.10776985954942861d0
					pos(40,4)=0.43395146141140677d0
					pos(41,4)=0.43395146141140677d0
					pos(42,1)=-1.3762773181382007d-3
					pos(43,1)=-1.3762773181382007d-3
					pos(44,1)=0.27655347263680734d0
					pos(45,1)=-1.3762773181382007d-3
					pos(46,1)=0.27655347263680734d0
					pos(47,1)=-1.3762773181382007d-3
					pos(48,1)=0.27655347263680734d0
					pos(49,1)=-1.3762773181382007d-3
					pos(50,1)=-1.3762773181382007d-3
					pos(51,2)=-1.3762773181382007d-3
					pos(52,2)=-1.3762773181382007d-3
					pos(53,2)=0.27655347263680734d0
					pos(42,2)=-1.3762773181382007d-3
					pos(43,2)=0.27655347263680734d0
					pos(44,2)=-1.3762773181382007d-3
					pos(45,2)=0.27655347263680734d0
					pos(46,2)=-1.3762773181382007d-3
					pos(47,2)=-1.3762773181382007d-3
					pos(48,3)=-1.3762773181382007d-3
					pos(49,3)=-1.3762773181382007d-3
					pos(50,3)=0.27655347263680734d0
					pos(51,3)=-1.3762773181382007d-3
					pos(52,3)=0.27655347263680734d0
					pos(53,3)=-1.3762773181382007d-3
					pos(42,3)=0.27655347263680734d0
					pos(43,3)=-1.3762773181382007d-3
					pos(44,3)=-1.3762773181382007d-3
					pos(45,4)=-1.3762773181382007d-3
					pos(46,4)=-1.3762773181382007d-3
					pos(47,4)=0.27655347263680734d0
					pos(48,4)=-1.3762773181382007d-3
					pos(49,4)=0.27655347263680734d0
					pos(50,4)=-1.3762773181382007d-3
					pos(51,4)=0.27655347263680734d0
					pos(52,4)=-1.3762773181382007d-3
					pos(53,4)=-1.3762773181382007d-3
					wg(1)=-0.13779903832610864d0
					wg(2:5)=1.8653365690852895d-3
					wg(6:9)=4.3094239694934006d-3
					wg(10:13)=-0.090184766481201525d0
					wg(14:17)=0.044672576202511444d0
					wg(18:29)=0.034700405884550761d0
					wg(30:41)=3.3525839026606469d-3
					wg(42:53)=4.3162887555699692d-4
				endif	
				if (lin) then
					nod0(1,1)=+1.0d0; nod0(1,2)= 0.0d0; nod0(1,3)= 0.0d0; nod0(1,4)= 0.0d0
					nod0(2,1)= 0.0d0; nod0(2,2)=+1.0d0; nod0(2,3)= 0.0d0; nod0(2,4)= 0.0d0
					nod0(3,1)= 0.0d0; nod0(3,2)= 0.0d0; nod0(3,3)=+1.0d0; nod0(3,4)= 0.0d0
					nod0(4,1)= 0.0d0; nod0(4,2)= 0.0d0; nod0(4,3)= 0.0d0; nod0(4,4)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3); V=pos(igp,4)
						if (X.EQ.0.0d0) X=1.0d0-Y-Z-V
						if (Y.EQ.0.0d0) Y=1.0d0-Z-V-X
						if (Z.EQ.0.0d0) Z=1.0d0-V-X-Y
						if (V.EQ.0.0d0) V=1.0d0-X-Y-Z
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3); V0=nod0(ine,4)
							N(ine,igp)=X0*X+Y0*Y+Z0*Z+V0*V
							dN(ine,igp,1)=X0-V0
							dN(ine,igp,2)=Y0-V0
							dN(ine,igp,3)=Z0-V0
						enddo
					enddo
				else
					nod0(1,1)=+1.0d0; nod0(1,2)= 0.0d0; nod0(1,3)= 0.0d0; nod0(1,4)= 0.0d0
					nod0(2,1)= 0.0d0; nod0(2,2)=+1.0d0; nod0(2,3)= 0.0d0; nod0(2,4)= 0.0d0
					nod0(3,1)= 0.0d0; nod0(3,2)= 0.0d0; nod0(3,3)=+1.0d0; nod0(3,4)= 0.0d0
					nod0(4,1)= 0.0d0; nod0(4,2)= 0.0d0; nod0(4,3)= 0.0d0; nod0(4,4)=+1.0d0
					nod0(5,1)=+0.5d0; nod0(5,2)=+0.5d0; nod0(5,3)= 0.0d0; nod0(5,4)= 0.0d0
					nod0(6,1)= 0.0d0; nod0(6,2)=+0.5d0; nod0(6,3)=+0.5d0; nod0(6,4)= 0.0d0
					nod0(7,1)=+0.5d0; nod0(7,2)= 0.0d0; nod0(7,3)=+0.5d0; nod0(7,4)= 0.0d0
					nod0(8,1)=+0.5d0; nod0(8,2)= 0.0d0; nod0(8,3)= 0.0d0; nod0(8,4)=+0.5d0
					nod0(9,1)= 0.0d0; nod0(9,2)=+0.5d0; nod0(9,3)= 0.0d0; nod0(9,4)=+0.5d0
					nod0(10,1)=0.0d0; nod0(10,2)=0.0d0; nod0(10,3)=0.5d0; nod0(10,4)=0.5d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3); V=pos(igp,4)
						if (X.EQ.0.0d0) X=1.0d0-Y-Z-V
						if (Y.EQ.0.0d0) Y=1.0d0-Z-V-X
						if (Z.EQ.0.0d0) Z=1.0d0-V-X-Y
						if (V.EQ.0.0d0) V=1.0d0-X-Y-Z
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3); V0=nod0(ine,4)
							if (ine.LE.4) then
								N(ine,igp)=X0*(2.0d0*X*X-X)+Y0*(2.0d0*Y*Y-Y)+Z0*&
									&(2.0d0*Z*Z-Z)+V0*(2.0d0*V*V-V)
								dN(ine,igp,1)=X0*(4.0d0*X-1.0d0)-V0*(4.0d0*V-1.0d0)
								dN(ine,igp,2)=Y0*(4.0d0*Y-1.0d0)-V0*(4.0d0*V-1.0d0)
								dN(ine,igp,3)=Z0*(4.0d0*Z-1.0d0)-V0*(4.0d0*V-1.0d0)
							else
								N(ine,igp)=1.6d1*(X0*Y0*X*Y+X0*Z0*X*Z+X0*V0*X*V+Y0*Z0*Y*Z+&
									&Y0*V0*Y*V+Z0*V0*Z*V)
								dN(ine,igp,1)=1.6d1*(X0*(Y0*Y+Z0*Z)+V0*(X0*V-X0*X-Y0*Y-Z0*Z))
								dN(ine,igp,2)=1.6d1*(Y0*(X0*X+Z0*Z)+V0*(Y0*V-X0*X-Y0*Y-Z0*Z))
								dN(ine,igp,3)=1.6d1*(Z0*(X0*X+Y0*Y)+V0*(Z0*V-X0*X-Y0*Y-Z0*Z))
							endif
						enddo
					enddo
				endif
			end select shapefunc
		deallocate(pos)
!
	end subroutine gausstri
!	_____________________________________________________________________________________
!
!
!
	subroutine gaussqua	(ngp,nne,lin,refin,di,wg,N,dN)
!	_____________________________________________________________________________________
		implicit none
		integer,intent(in)::ngp,nne,di
		logical,intent(in)::lin,refin
		double precision,intent(out)::wg(:),N(:,:),dN(:,:,:)
		integer::igp,ine
		double precision::X,Y,Z,X0,Y0,Z0,g,k,l
		double precision,allocatable::pos(:,:),nod0(:,:)
!		---------------------------------------------------------------------------------
!	calculation of shape function values for quadrangular elements
		wg=0.0d0; N=0.0d0; dN=0.0d0; allocate(pos(ngp,di),nod0(nne,di)); pos=0.0d0
!		
		shapefunc:select case (di)
			case(0)
				wg=1.0d0; N=1.0d0; dN=0.0d0
			case(1)
				if (.NOT.refin) then ! degree 5
					pos(1,1)=-sqrt(0.6d0) 
					pos(2,1)=0.0d0
					pos(3,1)=sqrt(0.6d0)
					wg(1)=5.0d0/9.0d0
					wg(2)=8.0d0/9.0d0 
					wg(3)=5.0d0/9.0d0
				else ! degree 11
!					pos(1,1)=-0.932469514203152d0
!					pos(2,1)=-0.661209386466265d0
!					pos(3,1)=-0.238619186083197d0
!					pos(4,1)=0.238619186083197d0
!					pos(5,1)=0.661209386466265d0
!					pos(6,1)=0.932469514203152d0
!					wg(1)=0.171324492379170d0
!					wg(2)=0.360761573048139d0
!					wg(3:4)=0.467913934572691d0
!					wg(5)=0.360761573048139d0
!					wg(6)=0.171324492379170d0
					pos(1,1)=-0.973906528d0
					pos(2,1)=-0.865063366d0
					pos(3,1)=-0.679409568d0
					pos(4,1)=-0.433395394d0
					pos(5,1)=-0.148874338d0
					pos(6,1)=-pos(5,1)
					pos(7,1)=-pos(4,1)
					pos(8,1)=-pos(3,1)
					pos(9,1)=-pos(2,1)
					pos(10,1)=-pos(1,1)
					wg(1)=0.066671344d0
					wg(2)=0.149451362d0
					wg(3)=0.219086362d0
					wg(4)=0.269266719d0
					wg(5)=0.295524244d0
					wg(6)=wg(5)
					wg(7)=wg(4)
					wg(8)=wg(3)
					wg(9)=wg(2)
					wg(10)=wg(1)

				endif
				if (lin) then
					nod0(1,1)=-1.0d0
					nod0(2,1)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1)
						do ine=1,nne
							X0=nod0(ine,1)
							N(ine,igp)=0.5d0*(1.0d0+X0*X)
							dN(ine,igp,1)=0.5d0*X0
						enddo
					enddo
				else
					nod0(1,1)=-1.0d0
					nod0(2,1)=+1.0d0
					nod0(3,1)= 0.0d0
					do igp=1,ngp
						X=pos(igp,1)
						do ine=1,nne
							X0=nod0(ine,1)
							if (ine.LE.2) then
								N(ine,igp)=0.5d0*X*(X+X0)
								dN(ine,igp,1)=0.5d0*(2.0d0*X+X0)
							endif
							if (ine.GE.3) then
								N(ine,igp)=1.0d0-X*X
								dN(ine,igp,1)=-2.0d0*X
							endif
						enddo
					enddo
				endif
			case(2)
				if (.NOT.refin) then ! degree 5
					pos(1,1)=0.0d0
					pos(2,1)=0.0d0
					pos(3,1)=0.0d0
					pos(4,1)=0.77459666924148337d0
					pos(5,1)=0.77459666924148337d0
					pos(6,1)=-0.77459666924148337d0
					pos(7,1)=-0.77459666924148337d0
					pos(1,2)=0.0d0
					pos(2,2)=0.96609178307929590d0
					pos(3,2)=-0.96609178307929590d0
					pos(4,2)=0.57735026918962576d0
					pos(5,2)=-0.57735026918962576d0
					pos(6,2)=0.57735026918962576d0
					pos(7,2)=-0.57735026918962576d0
					wg(1)=1.1428571428571428d0
					wg(2:3)=0.31746031746031746d0
					wg(4:7)= 0.55555555555555555d0
				else ! degree 11
					pos(1,1)=0.98263922354085547d0
					pos(2,1)=-0.98263922354085547d0
					pos(3,1)=-0.69807610454956756d0
					pos(4,1)=0.69807610454956756d0
					pos(1,2)=0.69807610454956756d0
					pos(2,2)=-0.69807610454956756d0
					pos(3,2)=0.98263922354085547d0
					pos(4,2)=-0.98263922354085547d0
					pos(5,1)=0.82577583590296393d0
					pos(6,1)=-0.82577583590296393d0
					pos(7,1)=-0.93948638281673690d0
					pos(8,1)=0.93948638281673690d0
					pos(5,2)=0.93948638281673690d0
					pos(6,2)=-0.93948638281673690d0
					pos(7,2)=0.82577583590296393d0
					pos(8,2)=-0.82577583590296393d0
					pos(9,1)=0.18858613871864195d0
					pos(10,1)=-0.18858613871864195d0
					pos(11,1)=-0.95353952820153201d0
					pos(12,1)=0.95353952820153201d0
					pos(9,2)=0.95353952820153201d0
					pos(10,2)=-0.95353952820153201d0
					pos(11,2)=0.18858613871864195d0
					pos(12,2)=-0.18858613871864195d0
					pos(13,1)=0.81252054830481310d0
					pos(14,1)=-0.81252054830481310d0
					pos(15,1)=-0.31562343291525419d0
					pos(16,1)=0.31562343291525419d0
					pos(13,2)=0.31562343291525419d0
					pos(14,2)=-0.31562343291525419d0
					pos(15,2)=0.81252054830481310d0
					pos(16,2)=-0.81252054830481310d0
					pos(17,1)=0.52532025036454776d0
					pos(18,1)=-0.52532025036454776d0
					pos(19,1)=-0.71200191307533630d0
					pos(20,1)=0.71200191307533630d0
					pos(17,2)=0.71200191307533630d0
					pos(18,2)=-0.71200191307533630d0
					pos(19,2)=0.52532025036454776d0
					pos(20,2)=-0.52532025036454776d0
					pos(21,1)=0.041658071912022368d0
					pos(22,1)=-0.041658071912022368d0
					pos(23,1)=-0.42484724884866925d0
					pos(24,1)=0.42484724884866925d0
					pos(21,2)=0.42484724884866925d0
					pos(22,2)=-0.42484724884866925d0
					pos(23,2)=0.041658071912022368d0
					pos(24,2)=-0.041658071912022368d0
					wg(1:4)=0.048020763350723814d0
					wg(5:8)=0.066071329164550595d0
					wg(9:12)=0.097386777358668164d0
					wg(13:16)=0.21173634999894860d0
					wg(17:20)=0.22562606172886338d0
					wg(21:24)=0.35115871839824543d0
				endif
				if (lin) then
					nod0(1,1)=-1.0d0; nod0(1,2)=-1.0d0
					nod0(2,1)=+1.0d0; nod0(2,2)=-1.0d0
					nod0(3,1)=+1.0d0; nod0(3,2)=+1.0d0
					nod0(4,1)=-1.0d0; nod0(4,2)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2)
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2)
							N(ine,igp)=0.25d0*(1.0d0+X0*X)*(1.0d0+Y0*Y)
							dN(ine,igp,1)=0.25d0*X0*(1.0d0+Y0*Y)
							dN(ine,igp,2)=0.25d0*Y0*(1.0d0+X0*X)
						enddo
					enddo
				else
					nod0(1,1)=-1.0d0; nod0(1,2)=-1.0d0
					nod0(2,1)=+1.0d0; nod0(2,2)=-1.0d0
					nod0(3,1)=+1.0d0; nod0(3,2)=+1.0d0
					nod0(4,1)=-1.0d0; nod0(4,2)=+1.0d0
					nod0(5,1)= 0.0d0; nod0(5,2)=-1.0d0
					nod0(6,1)=+1.0d0; nod0(6,2)= 0.0d0
					nod0(7,1)= 0.0d0; nod0(7,2)=+1.0d0
					nod0(8,1)=-1.0d0; nod0(8,2)= 0.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2)
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2)
							if (ine.LE.4) then
								N(ine,igp)=0.25d0*(1.0d0+X0*X)*(1.0d0+Y0*Y)*(X0*X+Y0*Y-1.0d0)
								dN(ine,igp,1)=0.25d0*(1.0d0+Y0*Y)*X0*(2.0d0*X0*X+Y0*Y)
								dN(ine,igp,2)=0.25d0*(1.0d0+X0*X)*Y0*(X0*X+2.0d0*Y0*Y)
							endif
							if (ine.GE.5) then
								N(ine,igp)=0.5d0*((1.0d0-X0*X0)*(1-X*X)*(1.0d0+Y0*Y)+&
									&(1.0d0-Y0*Y0)*(1.0d0-Y*Y)*(1+X0*X))
								dN(ine,igp,1)=0.5d0*((1.0d0-X0*X0)*(-2.0d0)*X*(1.0d0+Y0*Y)+&
									&(1.0d0-Y0*Y0)*(1-Y*Y)*X0)
								dN(ine,igp,2)=0.5d0*((1.0d0-X0*X0)*(1.0d0-X*X)*Y0+(1.0d0-&
									&Y0*Y0)*(-2.0d0)*Y*(1+X0*X))
							endif
						enddo
					enddo
				endif
			case(3)
				if (.NOT.refin) then ! degree 5
					pos(1,1)=-0.79582242575422146d0
					pos(2,1)=0.79582242575422146d0
					pos(2:6,1)=0.0d0
					pos(1:2,2)=0.0d0
					pos(3,2)=-0.79582242575422146d0
					pos(4,2)=0.79582242575422146d0
					pos(5:6,2)=0.0d0
					pos(1:4,3)=0.0d0
					pos(5,3)=-0.79582242575422146d0
					pos(6,3)=0.79582242575422146d0 
					pos(7,1)=0.75878691063932814d0
					pos(8,1)=-0.75878691063932814d0
					pos(9,1)=0.75878691063932814d0
					pos(10,1)=-0.75878691063932814d0
					pos(11,1)=0.75878691063932814d0
					pos(12,1)=-0.75878691063932814d0
					pos(13,1)=0.75878691063932814d0
					pos(14,1)=-0.75878691063932814d0
					pos(7,2)=0.75878691063932814d0
					pos(8,2)=0.75878691063932814d0
					pos(9,2)=-0.75878691063932814d0
					pos(10,2)=-0.75878691063932814d0
					pos(11,2)=0.75878691063932814d0
					pos(12,2)=0.75878691063932814d0
					pos(13,2)=-0.75878691063932814d0
					pos(14,2)=-0.75878691063932814d0
					pos(7,3)=0.75878691063932814d0
					pos(8,3)=0.75878691063932814d0
					pos(9,3)=0.75878691063932814d0
					pos(10,3)=0.75878691063932814d0
					pos(11,3)=-0.75878691063932814d0
					pos(12,3)=-0.75878691063932814d0
					pos(13,3)=-0.75878691063932814d0
					pos(14,3)=-0.75878691063932814d0
					wg(1:6)=0.88642659279778393d0
					wg(7:14)=0.33518005540166204d0 
				else ! degree 11
					pos(1,1)=0.72213303887441850d0
					pos(2,1)=-0.72213303887441850d0
					pos(3,1)=0.0d0
					pos(4,1)=0.0d0
					pos(5,1)=0.0d0
					pos(6,1)=0.0d0
					pos(1,2)=0.0d0
					pos(2,2)=0.0d0
					pos(3,2)=0.72213303887441850d0
					pos(4,2)=-0.72213303887441850d0
					pos(5,2)=0.0d0
					pos(6,2)=0.0d0
					pos(1,3)=0.0d0
					pos(2,3)=0.0d0
					pos(3,3)=0.0d0
					pos(4,3)=0.0d0
					pos(5,3)=0.72213303887441850d0
					pos(6,3)=-0.72213303887441850d0
					pos(7,1)=0.80393346721528444d0
					pos(8,1)=-0.80393346721528444d0
					pos(9,1)=0.80393346721528444d0
					pos(10,1)=-0.80393346721528444d0
					pos(11,1)=0.80393346721528444d0
					pos(12,1)=-0.80393346721528444d0
					pos(13,1)=0.80393346721528444d0
					pos(14,1)=-0.80393346721528444d0
					pos(15,1)=0.0d0
					pos(16,1)=0.0d0
					pos(17,1)=0.0d0
					pos(18,1)=0.0d0
					pos(7,2)=0.80393346721528444d0
					pos(8,2)=0.80393346721528444d0
					pos(9,2)=-0.80393346721528444d0
					pos(10,2)=-0.80393346721528444d0
					pos(11,2)=0.0d0
					pos(12,2)=0.0d0
					pos(13,2)=0.0d0
					pos(14,2)=0.0d0
					pos(15,2)=0.80393346721528444d0
					pos(16,2)=0.80393346721528444d0
					pos(17,2)=-0.80393346721528444d0
					pos(18,2)=-0.80393346721528444d0
					pos(7,3)=0.0d0
					pos(8,3)=0.0d0
					pos(9,3)=0.0d0
					pos(10,3)=0.0d0
					pos(11,3)=0.80393346721528444d0
					pos(12,3)=0.80393346721528444d0
					pos(13,3)=0.80393346721528444d0
					pos(14,3)=0.80393346721528444d0
					pos(15,3)=-0.80393346721528444d0
					pos(16,3)=-0.80393346721528444d0
					pos(17,3)=-0.80393346721528444d0
					pos(18,3)=-0.80393346721528444d0
					pos(19,1)=0.28077258665127436d0
					pos(20,1)=-0.28077258665127436d0
					pos(21,1)=0.28077258665127436d0
					pos(22,1)=-0.28077258665127436d0
					pos(23,1)=0.28077258665127436d0
					pos(24,1)=-0.28077258665127436d0
					pos(25,1)=0.28077258665127436d0
					pos(26,1)=-0.28077258665127436d0
					pos(19,2)=0.28077258665127436d0
					pos(20,2)=0.28077258665127436d0
					pos(21,2)=-0.28077258665127436d0
					pos(22,2)=-0.28077258665127436d0
					pos(23,2)=0.28077258665127436d0
					pos(24,2)=0.28077258665127436d0
					pos(25,2)=-0.28077258665127436d0
					pos(26,2)=-0.28077258665127436d0
					pos(19,3)=0.28077258665127436d0
					pos(20,3)=0.28077258665127436d0
					pos(21,3)=0.28077258665127436d0
					pos(22,3)=0.28077258665127436d0
					pos(23,3)=-0.28077258665127436d0
					pos(24,3)=-0.28077258665127436d0
					pos(25,3)=-0.28077258665127436d0
					pos(26,3)=-0.28077258665127436d0
					pos(27,1)=0.53365400888049707d0
					pos(28,1)=-0.53365400888049707d0
					pos(29,1)=0.53365400888049707d0
					pos(30,1)=-0.53365400888049707d0
					pos(31,1)=0.53365400888049707d0
					pos(32,1)=-0.53365400888049707d0
					pos(33,1)=0.53365400888049707d0
					pos(34,1)=-0.53365400888049707d0
					pos(27,2)=0.53365400888049707d0
					pos(28,2)=0.53365400888049707d0
					pos(29,2)=-0.53365400888049707d0
					pos(30,2)=-0.53365400888049707d0
					pos(31,2)=0.53365400888049707d0
					pos(32,2)=0.53365400888049707d0
					pos(33,2)=-0.53365400888049707d0
					pos(34,2)=-0.53365400888049707d0
					pos(27,3)=0.53365400888049707d0
					pos(28,3)=0.53365400888049707d0
					pos(29,3)=0.53365400888049707d0
					pos(30,3)=0.53365400888049707d0
					pos(31,3)=-0.53365400888049707d0
					pos(32,3)=-0.53365400888049707d0
					pos(33,3)=-0.53365400888049707d0
					pos(34,3)=-0.53365400888049707d0
					pos(35,1)=0.80948820196309895d0
					pos(36,1)=-0.80948820196309895d0
					pos(37,1)=0.80948820196309895d0
					pos(38,1)=-0.80948820196309895d0
					pos(39,1)=0.80948820196309895d0
					pos(40,1)=-0.80948820196309895d0
					pos(41,1)=0.80948820196309895d0
					pos(42,1)=-0.80948820196309895d0
					pos(35,2)=0.80948820196309895d0
					pos(36,2)=0.80948820196309895d0
					pos(37,2)=-0.80948820196309895d0
					pos(38,2)=-0.80948820196309895d0
					pos(39,2)=0.80948820196309895d0
					pos(40,2)=0.80948820196309895d0
					pos(41,2)=-0.80948820196309895d0
					pos(42,2)=-0.80948820196309895d0
					pos(35,3)=0.80948820196309895d0
					pos(36,3)=0.80948820196309895d0
					pos(37,3)=0.80948820196309895d0
					pos(38,3)=0.80948820196309895d0
					pos(39,3)=-0.80948820196309895d0
					pos(40,3)=-0.80948820196309895d0
					pos(41,3)=-0.80948820196309895d0
					pos(42,3)=-0.80948820196309895d0
					pos(43,1)=0.98009949100907141d0
					pos(44,1)=-0.98009949100907141d0
					pos(45,1)=0.98009949100907141d0
					pos(46,1)=-0.98009949100907141d0
					pos(47,1)=0.98009949100907141d0
					pos(48,1)=-0.98009949100907141d0
					pos(49,1)=0.98009949100907141d0
					pos(50,1)=-0.98009949100907141d0
					pos(51,1)=0.98009949100907141d0
					pos(52,1)=0.98009949100907141d0
					pos(53,1)=-0.98009949100907141d0
					pos(54,1)=-0.98009949100907141d0
					pos(55,1)=0.98009949100907141d0
					pos(56,1)=0.98009949100907141d0
					pos(57,1)=-0.98009949100907141d0
					pos(58,1)=-0.98009949100907141d0
					pos(59,1)=0.53078383119382638d0
					pos(60,1)=0.53078383119382638d0
					pos(61,1)=0.53078383119382638d0
					pos(62,1)=0.53078383119382638d0
					pos(63,1)=-0.53078383119382638d0
					pos(64,1)=-0.53078383119382638d0
					pos(65,1)=-0.53078383119382638d0
					pos(66,1)=-0.53078383119382638d0
					pos(43,2)=0.98009949100907141d0
					pos(44,2)=-0.98009949100907141d0
					pos(45,2)=0.98009949100907141d0
					pos(46,2)=-0.98009949100907141d0
					pos(47,2)=0.98009949100907141d0
					pos(48,2)=-0.98009949100907141d0
					pos(49,2)=0.98009949100907141d0
					pos(50,2)=-0.98009949100907141d0
					pos(51,2)=0.53078383119382638d0
					pos(52,2)=0.53078383119382638d0
					pos(53,2)=-0.53078383119382638d0
					pos(54,2)=-0.53078383119382638d0
					pos(55,2)=0.53078383119382638d0
					pos(56,2)=0.53078383119382638d0
					pos(57,2)=-0.53078383119382638d0
					pos(58,2)=-0.53078383119382638d0
					pos(59,2)=0.98009949100907141d0
					pos(60,2)=0.98009949100907141d0
					pos(61,2)=0.98009949100907141d0
					pos(62,2)=0.98009949100907141d0
					pos(63,2)=-0.98009949100907141d0
					pos(64,2)=-0.98009949100907141d0
					pos(65,2)=-0.98009949100907141d0
					pos(66,2)=-0.98009949100907141d0
					pos(43,3)=0.53078383119382638d0
					pos(44,3)=-0.53078383119382638d0
					pos(45,3)=0.53078383119382638d0
					pos(46,3)=-0.53078383119382638d0
					pos(47,3)=0.53078383119382638d0
					pos(48,3)=-0.53078383119382638d0
					pos(49,3)=0.53078383119382638d0
					pos(50,3)=-0.53078383119382638d0
					pos(51,3)=0.98009949100907141d0
					pos(52,3)=0.98009949100907141d0
					pos(53,3)=-0.98009949100907141d0
					pos(54,3)=-0.98009949100907141d0
					pos(55,3)=0.98009949100907141d0
					pos(56,3)=0.98009949100907141d0
					pos(57,3)=-0.98009949100907141d0
					pos(58,3)=-0.98009949100907141d0
					pos(59,3)=0.98009949100907141d0
					pos(60,3)=0.98009949100907141d0
					pos(61,3)=0.98009949100907141d0
					pos(62,3)=0.98009949100907141d0
					pos(63,3)=-0.98009949100907141d0
					pos(64,3)=-0.98009949100907141d0
					pos(65,3)=-0.98009949100907141d0
					pos(66,3)=-0.98009949100907141d0
					pos(67,1)= 0.40568598019509638d0
					pos(68,1)=- 0.40568598019509638d0
					pos(69,1)= 0.40568598019509638d0
					pos(70,1)=- 0.40568598019509638d0
					pos(71,1)= 0.40568598019509638d0
					pos(72,1)=- 0.40568598019509638d0
					pos(73,1)= 0.40568598019509638d0
					pos(74,1)=- 0.40568598019509638d0
					pos(75,1)= 0.40568598019509638d0
					pos(76,1)= 0.40568598019509638d0
					pos(77,1)=- 0.40568598019509638d0
					pos(78,1)=- 0.40568598019509638d0
					pos(79,1)= 0.40568598019509638d0
					pos(80,1)= 0.40568598019509638d0
					pos(81,1)=- 0.40568598019509638d0
					pos(82,1)=- 0.40568598019509638d0
					pos(83,1)=0.95458321892956610d0
					pos(84,1)=0.95458321892956610d0
					pos(85,1)=0.95458321892956610d0
					pos(86,1)=0.95458321892956610d0
					pos(87,1)=-0.95458321892956610d0
					pos(88,1)=-0.95458321892956610d0
					pos(89,1)=-0.95458321892956610d0
					pos(90,1)=-0.95458321892956610d0
					pos(67,2)= 0.40568598019509638d0
					pos(68,2)=- 0.40568598019509638d0
					pos(69,2)= 0.40568598019509638d0
					pos(70,2)=- 0.40568598019509638d0
					pos(71,2)= 0.40568598019509638d0
					pos(72,2)=- 0.40568598019509638d0
					pos(73,2)= 0.40568598019509638d0
					pos(74,2)=- 0.40568598019509638d0
					pos(75,2)=0.95458321892956610d0
					pos(76,2)=0.95458321892956610d0
					pos(77,2)=-0.95458321892956610d0
					pos(78,2)=-0.95458321892956610d0
					pos(79,2)=0.95458321892956610d0
					pos(80,2)=0.95458321892956610d0
					pos(81,2)=-0.95458321892956610d0
					pos(82,2)=-0.95458321892956610d0
					pos(83,2)= 0.40568598019509638d0
					pos(84,2)= 0.40568598019509638d0
					pos(85,2)= 0.40568598019509638d0
					pos(86,2)= 0.40568598019509638d0
					pos(87,2)=- 0.40568598019509638d0
					pos(88,2)=- 0.40568598019509638d0
					pos(89,2)=- 0.40568598019509638d0
					pos(90,2)=- 0.40568598019509638d0
					pos(67,3)=0.95458321892956610d0
					pos(68,3)=-0.95458321892956610d0
					pos(69,3)=0.95458321892956610d0
					pos(70,3)=-0.95458321892956610d0
					pos(71,3)=0.95458321892956610d0
					pos(72,3)=-0.95458321892956610d0
					pos(73,3)=0.95458321892956610d0
					pos(74,3)=-0.95458321892956610d0
					pos(75,3)= 0.40568598019509638d0
					pos(76,3)= 0.40568598019509638d0
					pos(77,3)=- 0.40568598019509638d0
					pos(78,3)=- 0.40568598019509638d0
					pos(79,3)= 0.40568598019509638d0
					pos(80,3)= 0.40568598019509638d0
					pos(81,3)=- 0.40568598019509638d0
					pos(82,3)=- 0.40568598019509638d0
					pos(83,3)= 0.40568598019509638d0
					pos(84,3)= 0.40568598019509638d0
					pos(85,3)= 0.40568598019509638d0
					pos(86,3)= 0.40568598019509638d0
					pos(87,3)=- 0.40568598019509638d0
					pos(88,3)=- 0.40568598019509638d0
					pos(89,3)=- 0.40568598019509638d0
					pos(90,3)=- 0.40568598019509638d0
					wg(1:6)=0.23693539619216446d0
					wg(7:18)=0.12821825421548476d0
					wg(19:26)=0.13590961715641601d0
					wg(27:34)=0.17776806487240386d0
					wg(35:42)=0.062009470300184584d0
					wg(43:66)=0.012950569520258584d0
					wg(67:90)=0.071810736880956427d0
				endif
				if (lin) then
					nod0(1,1)=-1.0d0; nod0(1,2)=-1.0d0; nod0(1,3)=-1.0d0
					nod0(2,1)=+1.0d0; nod0(2,2)=-1.0d0; nod0(2,3)=-1.0d0
					nod0(3,1)=+1.0d0; nod0(3,2)=+1.0d0; nod0(3,3)=-1.0d0
					nod0(4,1)=-1.0d0; nod0(4,2)=+1.0d0; nod0(4,3)=-1.0d0
					nod0(5,1)=-1.0d0; nod0(5,2)=-1.0d0; nod0(5,3)=+1.0d0
					nod0(6,1)=+1.0d0; nod0(6,2)=-1.0d0; nod0(6,3)=+1.0d0
					nod0(7,1)=+1.0d0; nod0(7,2)=+1.0d0; nod0(7,3)=+1.0d0
					nod0(8,1)=-1.0d0; nod0(8,2)=+1.0d0; nod0(8,3)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3)
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3)
							N(ine,igp)=0.125d0*(1.0d0+X0*X)*(1.0d0+Y0*Y)*(1.0d0+Z0*Z)
							dN(ine,igp,1)=0.125d0*X0*(1.0d0+Y0*Y)*(1.0d0+Z0*Z)
							dN(ine,igp,2)=0.125d0*Y0*(1.0d0+X0*X)*(1.0d0+Z0*Z)
							dN(ine,igp,3)=0.125d0*Z0*(1.0d0+X0*X)*(1.0d0+Y0*Y)
						enddo
					enddo
				else
					nod0(1,1)=-1.0d0; nod0(1,2)=-1.0d0; nod0(1,3)=-1.0d0
					nod0(2,1)=+1.0d0; nod0(2,2)=-1.0d0; nod0(2,3)=-1.0d0
					nod0(3,1)=+1.0d0; nod0(3,2)=+1.0d0; nod0(3,3)=-1.0d0
					nod0(4,1)=-1.0d0; nod0(4,2)=+1.0d0; nod0(4,3)=-1.0d0
					nod0(5,1)=-1.0d0; nod0(5,2)=-1.0d0; nod0(5,3)=+1.0d0
					nod0(6,1)=+1.0d0; nod0(6,2)=-1.0d0; nod0(6,3)=+1.0d0
					nod0(7,1)=+1.0d0; nod0(7,2)=+1.0d0; nod0(7,3)=+1.0d0
					nod0(8,1)=-1.0d0; nod0(8,2)=+1.0d0; nod0(8,3)=+1.0d0		
					nod0(9,1) = 0.0d0; nod0(9,2) =-1.0d0; nod0(9,3) =-1.0d0
					nod0(10,1)=+1.0d0; nod0(10,2)= 0.0d0; nod0(10,3)=-1.0d0
					nod0(11,1)= 0.0d0; nod0(11,2)=+1.0d0; nod0(11,3)=-1.0d0
					nod0(12,1)=-1.0d0; nod0(12,2)= 0.0d0; nod0(12,3)=-1.0d0
					nod0(13,1)=-1.0d0; nod0(13,2)=-1.0d0; nod0(13,3)= 0.0d0
					nod0(14,1)=+1.0d0; nod0(14,2)=-1.0d0; nod0(14,3)= 0.0d0
					nod0(15,1)=+1.0d0; nod0(15,2)=+1.0d0; nod0(15,3)= 0.0d0
					nod0(16,1)=-1.0d0; nod0(16,2)=+1.0d0; nod0(16,3)= 0.0d0
					nod0(17,1)= 0.0d0; nod0(17,2)=-1.0d0; nod0(17,3)=+1.0d0
					nod0(18,1)=+1.0d0; nod0(18,2)= 0.0d0; nod0(18,3)=+1.0d0
					nod0(19,1)= 0.0d0; nod0(19,2)=+1.0d0; nod0(19,3)=+1.0d0
					nod0(20,1)=-1.0d0; nod0(20,2)= 0.0d0; nod0(20,3)=+1.0d0
					do igp=1,ngp
						X=pos(igp,1); Y=pos(igp,2); Z=pos(igp,3)
						do ine=1,nne
							X0=nod0(ine,1); Y0=nod0(ine,2); Z0=nod0(ine,3)
							if (ine.LE.8) then
								N(ine,igp)=0.125d0*(1.0d0+X0*X)*(1.0d0+Y0*Y)*(1.0d0+Z0*Z)*&
									&(X0*X+Y0*Y+Z0*Z-2.0d0)
								dN(ine,igp,1)=0.125d0*(1.0d0+Y0*Y)*(1.0d0+Z0*Z)*X0*(2.0d0*&
									&X0*X+Y0*Y+Z0*Z-1.0d0)
								dN(ine,igp,2)=0.125d0*(1.0d0+X0*X)*(1.0d0+Z0*Z)*Y0*(2.0d0*&
									&Y0*Y+X0*X+Z0*Z-1.0d0)
								dN(ine,igp,3)=0.125d0*(1.0d0+X0*X)*(1.0d0+Y0*Y)*Z0*(2.0d0*&
									&Z0*Z+X0*X+Y0*Y-1.0d0)
							endif
							if (ine.GE.9) then
								N(ine,igp)=0.25d0*((1.0d0-X0*X0)*(1.0d0-X*X)*(1.0d0+Y0*Y)*&
									&(1.0d0+Z0*Z)+(1.0d0-Y0*Y0)*(1.0d0-Y*Y)*(1.0d0+X0*X)*&
									&(1.0d0+Z0*Z)+(1.0d0-Z0*Z0)*(1.0d0-Z*Z)*(1.0d0+X0*X)*&
									&(1.0d0+Y0*Y))
								dN(ine,igp,1)=0.25d0*((1.0d0-X0*X0)*(-2.0d0)*X*(1.0d0+Y0*Y)*&
									&(1.0d0+Z0*Z)+(1.0d0-Y0*Y0)*(1.0d0-Y*Y)*X0*(1.0d0+Z0*&
									&Z)+(1.0d0-Z0*Z0)*(1.0d0-Z*Z)*X0*(1.0d0+Y0*Y))
								dN(ine,igp,2)=0.25d0*((1.0d0-X0*X0)*(1.0d0-X*X)*Y0*(1.0d0+&
									&Z0*Z)+(1.0d0-Y0*Y0)*(-2.0d0)*Y*(1.0d0+X0*X)*(1.0d0+Z0*&
									&Z)+(1.0d0-Z0*Z0)*(1.0d0-Z*Z)*(1.0d0+X0*X)*Y0)
								dN(ine,igp,3)=0.25d0*((1.0d0-X0*X0)*(1.0d0-X*X)*(1.0d0+Y0*&
									&Y)*Z0+(1.0d0-Y0*Y0)*(1.0d0-Y*Y)*(1.0d0+X0*X)*Z0+&
									&(1.0d0-Z0*Z0)*(-2.0d0)*Z*(1.0d0+X0*X)*(1.0d0+Y0*Y))
							endif
						enddo
					enddo
				endif
			end select shapefunc
		deallocate(pos,nod0)
!
	end subroutine gaussqua
!	_____________________________________________________________________________________
!
!	Zienkiewicz OC, Taylor RL.  The finite element method (4th edition), Volume 1, McGraw-
!	Hill, 1994, pp 171-181
!
!	Lewis RW, Morgan K, Thomas HR, Seetharamu KN.  The finit element method in heat trans-
!	fer analysis, Wiley, 1996, pp. 41
!
!	Cools R. An Encyclopaedia of Cubature Formulas. Journal of Complexity 2003;19:445-453.
!
END MODULE FEM_shape_functions
